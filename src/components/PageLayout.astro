---
/**
 * PageLayout.astro - 一般的なページ用の共通レイアウトベース
 * - ヒーロー画像付きのページ（BlogPost、AboutPageなど）で使用
 * - 構造化データとパンくずリストを統合
 */
import type { ImageMetadata } from 'astro';
import BaseHead from './BaseHead.astro';
import Header from './Header.astro';
import Footer from './Footer.astro';
import Breadcrumb from './Breadcrumb.astro';
import { Image } from 'astro:assets';

interface BreadcrumbItem {
	name: string;
	url?: string;
}

interface Props {
	title: string;
	description: string;
	heroImage?: ImageMetadata;
	breadcrumbItems: BreadcrumbItem[];
	schema?: object;
	pageType?: 'article' | 'page';
	publishedTime?: Date;
	modifiedTime?: Date;
	author?: string;
	maxWidth?: 'small' | 'medium' | 'large' | 'full';
	showTitle?: boolean;
}

const {
	title,
	description,
	heroImage,
	breadcrumbItems,
	schema,
	pageType = 'page',
	publishedTime,
	modifiedTime,
	author,
	maxWidth = 'medium',
	showTitle = true
} = Astro.props;

const maxWidthClasses = {
	small: '720px',
	medium: '800px',
	large: '1200px',
	full: '100%'
};
---

<html lang="ja">
	<head>
		<BaseHead 
			title={title}
			description={description}
			type={pageType}
			publishedTime={publishedTime}
			modifiedTime={modifiedTime}
			author={author}
		/>
		{schema && (
			<script type="application/ld+json" set:html={JSON.stringify(schema)}></script>
		)}
		<style define:vars={{ maxWidth: maxWidthClasses[maxWidth] }}>
			main {
				width: 100%;
				max-width: 100%;
				margin: 0;
				padding: 2rem 0;
			}
			.hero-image {
				max-width: 1200px;
				margin: 0 auto 2rem auto;
				padding: 0 1rem;
			}
			.hero-image-wrapper {
				width: 100%;
				max-width: 960px;
				margin: 0 auto;
				aspect-ratio: 2 / 1;
				overflow: hidden;
				border-radius: 12px;
			}
			.hero-image img {
				display: block;
				width: 100%;
				height: 100%;
				margin: 0;
				object-fit: cover;
				object-position: center;
			}
			.content-wrapper {
				max-width: var(--maxWidth);
				margin: 0 auto;
				padding: 0 1rem;
			}
			.prose {
				background: var(--primary-background);
				box-shadow: var(--box-shadow);
				border-radius: 12px;
				padding: 2rem;
				color: var(--primary-foreground);
			}
			.page-title {
				text-align: center;
				margin-bottom: 2rem;
			}
			.page-title h1 {
				margin: 0;
				color: var(--primary-foreground);
			}
			@media (max-width: 767px) {
				main {
					padding: 1rem 0;
				}
				.prose {
					padding: 1.5rem;
				}
				.hero-image {
					margin-bottom: 1rem;
				}
				.hero-image-wrapper {
					max-width: 100%;
				}
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			{heroImage && (
				<div class="hero-image">
					<div class="hero-image-wrapper">
						<Image 
							width={960} 
							height={480} 
							src={heroImage} 
							alt={`${title}のヒーロー画像`} 
						/>
					</div>
				</div>
			)}
			<div class="content-wrapper">
				<Breadcrumb items={breadcrumbItems} />
				<article class="prose">
					{showTitle && (
						<div class="page-title">
							<h1>{title}</h1>
							<hr />
						</div>
					)}
					<slot />
				</article>
			</div>
		</main>
		<Footer />
	</body>
</html>